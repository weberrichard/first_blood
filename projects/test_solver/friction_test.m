clear;
nu = 3e-6;
rho = 1055;
d = 0.01;
l = 0.1;

dp = 1*133.3616;

v = dp*d*d/nu/rho/l/32;

E = 5e5;
s0 = 0.001;
d0 = 0.005;
nu_p = .5;

a = sqrt(1/rho*d0*s0*E/(1-nu_p^2)/d0^2);

v0 = 1;
ds = 0.01;
de = 0.005;
l = 0.1;

nx = 1001;
dx = l/(nx-1);
x = linspace(0,l,nx);

d = linspace(ds,de,nx);
A = d.^2*pi/4;

v = v0*A(1)./A;
p = zeros(nx,1);
for i=nx:-1:2
    p(i-1) = p(i) - dx*2*v(i)*v(i)*rho/d(i)*(de-ds)/l;
end

p_sim = [108218,108217,108216,108215,108214,108213,108211,108210,108209,108208,108207,108206,108205,108203,108202,108201,108200,108199,108198,108196,108195,108194,108193,108192,108190,108189,108188,108187,108186,108185,108183,108182,108181,108180,108178,108177,108176,108175,108174,108172,108171,108170,108169,108167,108166,108165,108164,108162,108161,108160,108159,108157,108156,108155,108153,108152,108151,108150,108148,108147,108146,108144,108143,108142,108140,108139,108138,108136,108135,108134,108132,108131,108130,108128,108127,108126,108124,108123,108122,108120,108119,108118,108116,108115,108113,108112,108111,108109,108108,108106,108105,108104,108102,108101,108099,108098,108097,108095,108094,108092,108091,108089,108088,108086,108085,108084,108082,108081,108079,108078,108076,108075,108073,108072,108070,108069,108067,108066,108064,108063,108061,108060,108058,108057,108055,108054,108052,108050,108049,108047,108046,108044,108043,108041,108039,108038,108036,108035,108033,108032,108030,108028,108027,108025,108023,108022,108020,108019,108017,108015,108014,108012,108010,108009,108007,108005,108004,108002,108000,107999,107997,107995,107994,107992,107990,107988,107987,107985,107983,107982,107980,107978,107976,107975,107973,107971,107969,107968,107966,107964,107962,107960,107959,107957,107955,107953,107951,107950,107948,107946,107944,107942,107940,107939,107937,107935,107933,107931,107929,107927,107925,107924,107922,107920,107918,107916,107914,107912,107910,107908,107906,107904,107902,107901,107899,107897,107895,107893,107891,107889,107887,107885,107883,107881,107879,107877,107875,107873,107871,107869,107866,107864,107862,107860,107858,107856,107854,107852,107850,107848,107846,107844,107841,107839,107837,107835,107833,107831,107829,107826,107824,107822,107820,107818,107816,107813,107811,107809,107807,107805,107802,107800,107798,107796,107793,107791,107789,107787,107784,107782,107780,107777,107775,107773,107770,107768,107766,107763,107761,107759,107756,107754,107752,107749,107747,107744,107742,107740,107737,107735,107732,107730,107727,107725,107723,107720,107718,107715,107713,107710,107708,107705,107703,107700,107698,107695,107693,107690,107687,107685,107682,107680,107677,107674,107672,107669,107667,107664,107661,107659,107656,107653,107651,107648,107645,107643,107640,107637,107635,107632,107629,107626,107624,107621,107618,107615,107613,107610,107607,107604,107601,107599,107596,107593,107590,107587,107584,107581,107579,107576,107573,107570,107567,107564,107561,107558,107555,107552,107549,107546,107543,107540,107537,107534,107531,107528,107525,107522,107519,107516,107513,107510,107507,107504,107500,107497,107494,107491,107488,107485,107482,107478,107475,107472,107469,107466,107462,107459,107456,107453,107449,107446,107443,107439,107436,107433,107429,107426,107423,107419,107416,107413,107409,107406,107402,107399,107395,107392,107389,107385,107382,107378,107375,107371,107368,107364,107360,107357,107353,107350,107346,107343,107339,107335,107332,107328,107324,107321,107317,107313,107310,107306,107302,107298,107295,107291,107287,107283,107279,107276,107272,107268,107264,107260,107256,107253,107249,107245,107241,107237,107233,107229,107225,107221,107217,107213,107209,107205,107201,107197,107193,107189,107184,107180,107176,107172,107168,107164,107159,107155,107151,107147,107143,107138,107134,107130,107125,107121,107117,107112,107108,107104,107099,107095,107091,107086,107082,107077,107073,107068,107064,107059,107055,107050,107046,107041,107036,107032,107027,107023,107018,107013,107009,107004,106999,106994,106990,106985,106980,106975,106971,106966,106961,106956,106951,106946,106941,106936,106932,106927,106922,106917,106912,106907,106902,106896,106891,106886,106881,106876,106871,106866,106861,106855,106850,106845,106840,106834,106829,106824,106819,106813,106808,106802,106797,106792,106786,106781,106775,106770,106764,106759,106753,106748,106742,106737,106731,106725,106720,106714,106708,106703,106697,106691,106685,106679,106674,106668,106662,106656,106650,106644,106638,106632,106626,106620,106614,106608,106602,106596,106590,106584,106578,106572,106565,106559,106553,106547,106540,106534,106528,106521,106515,106509,106502,106496,106489,106483,106476,106470,106463,106457,106450,106444,106437,106430,106424,106417,106410,106403,106396,106390,106383,106376,106369,106362,106355,106348,106341,106334,106327,106320,106313,106306,106299,106292,106284,106277,106270,106263,106255,106248,106241,106233,106226,106219,106211,106204,106196,106189,106181,106173,106166,106158,106150,106143,106135,106127,106119,106112,106104,106096,106088,106080,106072,106064,106056,106048,106040,106032,106024,106016,106007,105999,105991,105983,105974,105966,105957,105949,105941,105932,105924,105915,105906,105898,105889,105880,105872,105863,105854,105845,105837,105828,105819,105810,105801,105792,105783,105774,105765,105755,105746,105737,105728,105719,105709,105700,105690,105681,105672,105662,105653,105643,105633,105624,105614,105604,105594,105585,105575,105565,105555,105545,105535,105525,105515,105505,105495,105485,105474,105464,105454,105443,105433,105423,105412,105402,105391,105380,105370,105359,105348,105338,105327,105316,105305,105294,105283,105272,105261,105250,105239,105228,105216,105205,105194,105182,105171,105160,105148,105137,105125,105113,105102,105090,105078,105066,105054,105042,105030,105018,105006,104994,104982,104970,104958,104945,104933,104920,104908,104895,104883,104870,104858,104845,104832,104819,104806,104793,104780,104767,104754,104741,104728,104715,104701,104688,104675,104661,104648,104634,104620,104607,104593,104579,104565,104551,104537,104523,104509,104495,104481,104467,104452,104438,104423,104409,104394,104380,104365,104350,104335,104320,104306,104291,104275,104260,104245,104230,104215,104199,104184,104168,104153,104137,104121,104105,104089,104074,104058,104042,104025,104009,103993,103977,103960,103944,103927,103911,103894,103877,103860,103843,103826,103809,103792,103775,103758,103740,103723,103705,103688,103670,103652,103635,103617,103599,103581,103563,103544,103526,103508,103489,103471,103452,103433,103415,103396,103377,103358,103339,103320,103300,103281,103261,103242,103222,103203,103183,103163,103143,103123,103103,103083,103062,103042,103021,103001,102980,102959,102938,102917,102896,102875,102854,102832,102811,102789,102768,102746,102724,102702,102680,102658,102636,102613,102591,102568,102546,102523,102500,102477,102454,102431,102408,102384,102361,102337,102313,102290,102266,102242,102217,102193,102169,102144,102120,102095,102070,102045,102020,101995,101969,101944,101918,101893,101867,101841,101815,101789,101763,101736,101710,101683,101656,101629,101602,101575,101548,101520,101493,101465,101437,101409,101381,101353,101325,101296,101268,101239,101210,101181,101152,101122,101093,101063,101033,101004,100973,100943,100913,100882,100852,100821,100790,100759,100728,100696,100665,100633,100601,100569,100537,100505,100472,100440,100407,100374,100341,100307,100274,100240,100207,100173,100138,100104,100070,100035,100000];
x_sim = linspace(0,l,length(p_sim));

figure;
plot(x,p);
hold on; grid on;
plot(x_sim,p_sim-1e5);

v_sim = [1,1.001,1.002,1.00301,1.00401,1.00502,1.00603,1.00704,1.00805,1.00906,1.01008,1.01109,1.01211,1.01313,1.01415,1.01517,1.0162,1.01722,1.01825,1.01928,1.02031,1.02134,1.02237,1.02341,1.02444,1.02548,1.02652,1.02756,1.02861,1.02965,1.0307,1.03174,1.03279,1.03384,1.03489,1.03595,1.037,1.03806,1.03912,1.04018,1.04124,1.04231,1.04337,1.04444,1.04551,1.04658,1.04765,1.04872,1.0498,1.05087,1.05195,1.05303,1.05411,1.0552,1.05628,1.05737,1.05846,1.05955,1.06064,1.06173,1.06283,1.06392,1.06502,1.06612,1.06722,1.06833,1.06943,1.07054,1.07165,1.07276,1.07387,1.07499,1.0761,1.07722,1.07834,1.07946,1.08058,1.08171,1.08283,1.08396,1.08509,1.08622,1.08735,1.08849,1.08963,1.09076,1.0919,1.09305,1.09419,1.09534,1.09648,1.09763,1.09878,1.09994,1.10109,1.10225,1.10341,1.10457,1.10573,1.10689,1.10806,1.10923,1.1104,1.11157,1.11274,1.11392,1.11509,1.11627,1.11745,1.11863,1.11982,1.121,1.12219,1.12338,1.12457,1.12577,1.12696,1.12816,1.12936,1.13056,1.13177,1.13297,1.13418,1.13539,1.1366,1.13781,1.13903,1.14024,1.14146,1.14268,1.14391,1.14513,1.14636,1.14759,1.14882,1.15005,1.15128,1.15252,1.15376,1.155,1.15624,1.15749,1.15873,1.15998,1.16123,1.16249,1.16374,1.165,1.16626,1.16752,1.16878,1.17005,1.17131,1.17258,1.17385,1.17513,1.1764,1.17768,1.17896,1.18024,1.18152,1.18281,1.1841,1.18539,1.18668,1.18797,1.18927,1.19057,1.19187,1.19317,1.19447,1.19578,1.19709,1.1984,1.19971,1.20103,1.20235,1.20367,1.20499,1.20631,1.20764,1.20897,1.2103,1.21163,1.21297,1.21431,1.21564,1.21699,1.21833,1.21968,1.22103,1.22238,1.22373,1.22508,1.22644,1.2278,1.22916,1.23053,1.23189,1.23326,1.23463,1.23601,1.23738,1.23876,1.24014,1.24152,1.24291,1.2443,1.24569,1.24708,1.24847,1.24987,1.25127,1.25267,1.25407,1.25548,1.25689,1.2583,1.25971,1.26113,1.26254,1.26396,1.26539,1.26681,1.26824,1.26967,1.2711,1.27254,1.27397,1.27541,1.27685,1.2783,1.27975,1.2812,1.28265,1.2841,1.28556,1.28702,1.28848,1.28994,1.29141,1.29288,1.29435,1.29583,1.2973,1.29878,1.30026,1.30175,1.30324,1.30473,1.30622,1.30771,1.30921,1.31071,1.31221,1.31372,1.31522,1.31673,1.31825,1.31976,1.32128,1.3228,1.32432,1.32585,1.32738,1.32891,1.33044,1.33198,1.33352,1.33506,1.3366,1.33815,1.3397,1.34125,1.34281,1.34437,1.34593,1.34749,1.34906,1.35063,1.3522,1.35377,1.35535,1.35693,1.35851,1.3601,1.36168,1.36328,1.36487,1.36647,1.36806,1.36967,1.37127,1.37288,1.37449,1.3761,1.37772,1.37934,1.38096,1.38259,1.38421,1.38584,1.38748,1.38911,1.39075,1.39239,1.39404,1.39569,1.39734,1.39899,1.40065,1.40231,1.40397,1.40564,1.40731,1.40898,1.41065,1.41233,1.41401,1.41569,1.41738,1.41907,1.42076,1.42246,1.42416,1.42586,1.42756,1.42927,1.43098,1.4327,1.43441,1.43613,1.43786,1.43958,1.44131,1.44304,1.44478,1.44652,1.44826,1.45001,1.45175,1.45351,1.45526,1.45702,1.45878,1.46054,1.46231,1.46408,1.46586,1.46763,1.46941,1.4712,1.47298,1.47477,1.47657,1.47836,1.48016,1.48197,1.48377,1.48558,1.48739,1.48921,1.49103,1.49285,1.49468,1.49651,1.49834,1.50018,1.50202,1.50386,1.50571,1.50756,1.50941,1.51127,1.51313,1.51499,1.51686,1.51873,1.52061,1.52248,1.52436,1.52625,1.52814,1.53003,1.53192,1.53382,1.53572,1.53763,1.53954,1.54145,1.54337,1.54529,1.54721,1.54914,1.55107,1.553,1.55494,1.55688,1.55883,1.56078,1.56273,1.56469,1.56665,1.56861,1.57058,1.57255,1.57452,1.5765,1.57848,1.58047,1.58246,1.58445,1.58645,1.58845,1.59046,1.59246,1.59448,1.59649,1.59851,1.60054,1.60256,1.6046,1.60663,1.60867,1.61071,1.61276,1.61481,1.61687,1.61893,1.62099,1.62306,1.62513,1.6272,1.62928,1.63136,1.63345,1.63554,1.63763,1.63973,1.64184,1.64394,1.64605,1.64817,1.65029,1.65241,1.65454,1.65667,1.6588,1.66094,1.66309,1.66523,1.66739,1.66954,1.6717,1.67387,1.67604,1.67821,1.68039,1.68257,1.68475,1.68694,1.68914,1.69134,1.69354,1.69575,1.69796,1.70017,1.70239,1.70462,1.70685,1.70908,1.71132,1.71356,1.71581,1.71806,1.72031,1.72257,1.72484,1.72711,1.72938,1.73166,1.73394,1.73623,1.73852,1.74081,1.74311,1.74542,1.74773,1.75004,1.75236,1.75468,1.75701,1.75934,1.76168,1.76402,1.76637,1.76872,1.77108,1.77344,1.7758,1.77817,1.78055,1.78293,1.78531,1.7877,1.79009,1.79249,1.7949,1.7973,1.79972,1.80214,1.80456,1.80699,1.80942,1.81186,1.8143,1.81675,1.8192,1.82166,1.82412,1.82659,1.82906,1.83154,1.83402,1.83651,1.839,1.8415,1.844,1.84651,1.84902,1.85154,1.85406,1.85659,1.85913,1.86167,1.86421,1.86676,1.86931,1.87187,1.87444,1.87701,1.87958,1.88217,1.88475,1.88734,1.88994,1.89254,1.89515,1.89776,1.90038,1.90301,1.90564,1.90827,1.91091,1.91356,1.91621,1.91887,1.92153,1.9242,1.92687,1.92955,1.93223,1.93492,1.93762,1.94032,1.94303,1.94574,1.94846,1.95119,1.95392,1.95665,1.95939,1.96214,1.96489,1.96765,1.97042,1.97319,1.97596,1.97875,1.98153,1.98433,1.98713,1.98994,1.99275,1.99556,1.99839,2.00122,2.00405,2.0069,2.00974,2.0126,2.01546,2.01832,2.0212,2.02408,2.02696,2.02985,2.03275,2.03565,2.03856,2.04148,2.0444,2.04733,2.05026,2.0532,2.05615,2.0591,2.06206,2.06503,2.068,2.07098,2.07397,2.07696,2.07996,2.08296,2.08597,2.08899,2.09202,2.09505,2.09809,2.10113,2.10418,2.10724,2.11031,2.11338,2.11645,2.11954,2.12263,2.12573,2.12883,2.13195,2.13506,2.13819,2.14132,2.14446,2.14761,2.15076,2.15392,2.15709,2.16026,2.16344,2.16663,2.16983,2.17303,2.17624,2.17945,2.18268,2.18591,2.18915,2.19239,2.19564,2.1989,2.20217,2.20544,2.20873,2.21201,2.21531,2.21861,2.22193,2.22524,2.22857,2.2319,2.23524,2.23859,2.24195,2.24531,2.24868,2.25206,2.25545,2.25884,2.26224,2.26565,2.26907,2.27249,2.27593,2.27937,2.28281,2.28627,2.28973,2.29321,2.29669,2.30017,2.30367,2.30717,2.31068,2.3142,2.31773,2.32127,2.32481,2.32836,2.33192,2.33549,2.33907,2.34265,2.34624,2.34985,2.35345,2.35707,2.3607,2.36433,2.36798,2.37163,2.37529,2.37896,2.38263,2.38632,2.39001,2.39371,2.39743,2.40115,2.40487,2.40861,2.41236,2.41611,2.41988,2.42365,2.42743,2.43122,2.43502,2.43883,2.44264,2.44647,2.4503,2.45415,2.458,2.46186,2.46573,2.46961,2.4735,2.4774,2.48131,2.48523,2.48915,2.49309,2.49703,2.50099,2.50495,2.50892,2.51291,2.5169,2.5209,2.52491,2.52893,2.53296,2.537,2.54105,2.54511,2.54918,2.55326,2.55735,2.56145,2.56556,2.56968,2.57381,2.57794,2.58209,2.58625,2.59042,2.5946,2.59879,2.60299,2.6072,2.61142,2.61565,2.61989,2.62414,2.6284,2.63267,2.63695,2.64124,2.64554,2.64986,2.65418,2.65852,2.66286,2.66722,2.67158,2.67596,2.68035,2.68475,2.68915,2.69358,2.69801,2.70245,2.7069,2.71137,2.71584,2.72033,2.72483,2.72933,2.73385,2.73839,2.74293,2.74748,2.75205,2.75662,2.76121,2.76581,2.77042,2.77505,2.77968,2.78433,2.78898,2.79365,2.79833,2.80303,2.80773,2.81245,2.81718,2.82192,2.82667,2.83143,2.83621,2.841,2.8458,2.85061,2.85544,2.86027,2.86512,2.86999,2.87486,2.87975,2.88465,2.88956,2.89448,2.89942,2.90437,2.90933,2.91431,2.9193,2.9243,2.92931,2.93434,2.93938,2.94443,2.9495,2.95458,2.95967,2.96477,2.96989,2.97503,2.98017,2.98533,2.9905,2.99569,3.00089,3.0061,3.01132,3.01656,3.02182,3.02709,3.03237,3.03766,3.04297,3.04829,3.05363,3.05898,3.06435,3.06973,3.07512,3.08053,3.08595,3.09138,3.09684,3.1023,3.10778,3.11327,3.11878,3.12431,3.12985,3.1354,3.14097,3.14655,3.15215,3.15776,3.16339,3.16903,3.17469,3.18036,3.18605,3.19175,3.19747,3.20321,3.20896,3.21472,3.2205,3.2263,3.23211,3.23794,3.24378,3.24964,3.25552,3.26141,3.26732,3.27324,3.27918,3.28514,3.29111,3.2971,3.3031,3.30913,3.31516,3.32122,3.32729,3.33338,3.33948,3.34561,3.35174,3.3579,3.36407,3.37026,3.37647,3.38269,3.38893,3.39519,3.40147,3.40776,3.41407,3.4204,3.42675,3.43311,3.43949,3.44589,3.45231,3.45874,3.4652,3.47167,3.47816,3.48467,3.49119,3.49774,3.5043,3.51088,3.51748,3.5241,3.53074,3.5374,3.54407,3.55077,3.55748,3.56421,3.57097,3.57774,3.58453,3.59134,3.59817,3.60502,3.61188,3.61877,3.62568,3.63261,3.63956,3.64652,3.65351,3.66052,3.66755,3.6746,3.68166,3.68875,3.69586,3.70299,3.71015,3.71732,3.72451,3.73172,3.73896,3.74621,3.75349,3.76079,3.76811,3.77545,3.78281,3.7902,3.79761,3.80503,3.81248,3.81996,3.82745,3.83497,3.8425,3.85006,3.85765,3.86525,3.87288,3.88053,3.8882,3.8959,3.90362,3.91136,3.91913,3.92692,3.93473,3.94256,3.95042,3.95831,3.96621,3.97414,3.9821,3.99007,3.99807,4.0061];
x_sim = linspace(0,l,length(v_sim));

figure;
plot(x,v);
hold on; grid on;
plot(x_sim,v_sim);